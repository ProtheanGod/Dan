#! /usr/bin/env php
<?php

error_reporting(E_ALL);
ini_set("display_errors", true);

if (phpversion() < '5.6')
{
    die('PHP 5.6 is REQUIRED. Please update your php installation to at least php 5.6');
}

if (!defined('STDIN'))
{
    throw new Exception("CLI Only");
}

$phar = Phar::running(false);

define("PHAR", !empty($phar));

define("ROOT_DIR", PHAR ? dirname($phar) : __DIR__);
define("BASE_DIR", __DIR__);
define('CONFIG_DIR', ROOT_DIR . '/config');
define('STORAGE_DIR', ROOT_DIR . '/storage');
define('PLUGIN_DIR', ROOT_DIR . '/plugins');
define('COMMAND_DIR', ROOT_DIR . '/commands');
define('PLUGIN_STORAGE', STORAGE_DIR . '/plugins');

$loader = require(BASE_DIR . '/vendor/autoload.php');

set_error_handler(function($severity, $message, $filename, $lineno)
{
    debug("-------------------------");
    controlLog("{red}[{$severity}] PHP ERROR: {$message} in " . relative($filename) . " on line {$lineno}", true);
    debug("-------------------------");
});

(new Dan\Core\Dan($loader))->boot();